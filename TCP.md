# 前言
这篇文章实话说我有点虚，因为平时都不怎么研究这一块的，然后涉及到的知识点超多，我只能到处看看资料总结一下相关信息，所以在此我只想说句：
**本文章内容只代表个人立场，有错必改！**
原本打算一次性总结，后来越扯越多超过字数限制了，就干脆做成http系列文章了，不定时更新原有内容（发现哪里出错的话），不定时新增系列文章，请见谅!
[Http协议系列----OSI参考模型，协议原理构成，三次握手，四次挥手，连接管理](https://www.qdfuns.com/article/40831/577fa2647a7eb3123c6b138c6299c640.html)
[Http协议系列—-字符编码，cookie，缓存，疑难杂症](https://www.qdfuns.com/article/40831/8fbe235d81b5ada00b53ddde9fd848a4.html)
[Http协议系列—-进阶Https基础](https://www.qdfuns.com/article/40831/3ffb59e3d1dfc7ed44e521c2a57aeec7.html)
[WebSocket协议入门基础](https://www.qdfuns.com/article/40831/6db7957dad157aa4239ec144c0aa9c55.html)
[简单使用Nodejs+Socket.io2.0+boostrap4.0实现聊天室功能](https://www.qdfuns.com/article/40831/18843630b0a73d009fe9ed56e70156a8.html)

[bgcolor=#bf360c][color=#fff]PS: 好多人反映看不懂繁体字，鉴于这些理论性东西不仅枯燥而且复杂，我就都转简体吧。[/color][/bgcolor]



## OSI参考模型（来自百度百科）
开始进入正题之前先插个知识点，让大家对[color=#2b91e3]HTTP，TCP，UDP[/color]的底层构成有些抽象认识各负责什么功能。
[color=#2b91e3]OSI（Open System Interconnect）[/color]，即开放式系统互联。该体系结构标准定义了网络互连的七层框架（[color=#2b91e3]物理层、数据链路层、网络层、传输层、会话层、表示层和应用层[/color]），即[color=#2b91e3]ISO开放系统互连参考模型[/color]。在这一框架下进一步详细规定了每一层的功能，以实现开放系统环境中的互连性、互操作性和应用的可移植性。

### 物理层（Physical Layer）
物理层是OSI参考模型的最低层，它利用传输介质为数据链路层提供物理连接。它主要关心的是[color=#f4511e]通过物理链路从一个节点向另一个节点传送比特流，物理链路可能是铜线、卫星、微波或其他的通讯媒介[/color]。它关心的问题有：多少伏电压代表1？多少伏电压代表0？时钟速率是多少？采用全双工还是半双工传输？总的来说[color=#f4511e]物理层关心的是链路的机械、电气、功能和规程特性[/color]。


### 数据链路层（Data Link Layer）
数据链路层是[color=#f4511e]为网络层提供服务的，解决两个相邻结点之间的通信问题[/color]，传送的协议数据单元称为数据帧。
	数据帧中包含物理地址（又称MAC地址）、控制码、数据及校验码等信息。该层的[color=#f4511e]主要作用是通过校验、确认和反馈重发等手段，将不可靠的物理链路转换成对网络层来说无差错的数据链路[/color]。
	此外，数据链路层还要协调收发双方的数据传输速率，即进行流量控制，以防止接收方因来不及处理发送方来的高速数据而导致缓冲器溢出及线路阻塞。

### 网络层（Network Layer）
网络层是为传输层提供服务的，传送的协议数据单元称为数据包或分组。该层的[color=#f4511e]主要作用是解决如何使数据包通过各结点传送的问题，即通过路径选择算法（路由）将数据包送到目的地[/color]。另外，为避免通信子网中出现过多的数据包而造成网络阻塞，需要对流入的数据包数量进行控制（拥塞控制）。当数据包要跨越多个通信子网才能到达目的地时，还要解决网际互连的问题。

### 传输层（Transport Layer）
传输层的作用是[color=#f4511e]为上层协议提供端到端的可靠和透明的数据传输服务[/color]，包括处理差错控制和流量控制等问题。该层向高层屏蔽了下层数据通信的细节，使高层用户看到的只是在两个传输实体间的一条主机到主机的、可由用户控制和设定的、可靠的数据通路。
	传输层传送的协议数据单元称为段或报文。

### 会话层（Session Layer）
会话层[color=#f4511e]主要功能是管理和协调不同主机上各种进程之间的通信（对话），即负责建立、管理和终止应用程序之间的会话[/color]。会话层得名的原因是它很类似于两个实体间的会话概念。例如，一个交互的用户会话以登录到计算机开始，以注销结束。

### 表示层（Presentation Layer）
表示层[color=#f4511e]处理流经结点的数据编码的表示方式问题[/color]，以保证一个系统应用层发出的信息可被另一系统的应用层读出。如果必要，该层可提供一种标准表示形式，用于将计算机内部的多种数据表示格式转换成网络通信中采用的标准表示形式。数据压缩和加密也是表示层可提供的转换功能之一。

### 应用层（Application Layer）
应用层是OSI参考模型的最高层，是用户与网络的接口。该层[color=#f4511e]通过应用程序来完成网络用户的应用需求[/color]，如文件传输、收发电子邮件等。

### 具体通俗流程图
![图片描述](attimg://article/content/picture/201804/11/203657jjfixb6f2kbqobzj.png)
[color=#b1b1b1]（更多内容请自行查阅，本节到此为止了。）[/color]


##TCP/IP参考模型
当无线网络和卫星出现以后，现有的协议在和它们相连的时候出现了问题，所以需要一种新的参考体系结构。这个体系结构在它的两个主要协议出现以后，被称为[color=#2b91e3]TCP/IP参考模型（TCP/IP reference model）[/color]。
TCP/IP是一组用于实现网络互连的通信协议。Internet网络体系结构以TCP/IP为核心。基于TCP/IP的参考模型将协议分成四个层次，它们分别是：[color=#2b91e3]网络访问层、网际互联层、传输层（主机到主机）、和应用层[/color]。


### 网络接入层（即主机-网络层）
网络接入层与OSI参考模型中的物理层和数据链路层相对应。它[color=#f4511e]负责监视数据在主机和网络之间的交换[/color]。事实上，TCP/IP本身并未定义该层的协议，而由参与互连的各网络使用自己的物理层和数据链路层协议，然后与TCP/IP的网络接入层进行连接。地址解析协议（ARP）工作在此层，即OSI参考模型的数据链路层。

### 网际互联层
网际互联层对应于OSI参考模型的网络层，主要[color=#f4511e]解决主机到主机的通信问题[/color]。它所包含的协议设计数据包在整个网络上的逻辑传输。注重重新赋予主机一个IP地址来完成对主机的寻址，它还负责数据包在多种网络中的路由。该层有三个主要协议：[color=#2b91e3]网际协议（IP）[/color]、[color=#2b91e3]互联网组管理协议（IGMP）[/color]和[color=#2b91e3]互联网控制报文协议（ICMP）[/color]。
	IP协议是网际互联层最重要的协议，它提供的是一个可靠、无连接的数据报传递服务。

### 传输层（Transport Layer）
传输层对应于OSI参考模型的传输层，[color=#f4511e]为应用层实体提供端到端的通信功能，保证了数据包的顺序传送及数据的完整性[/color]。该层定义了两个主要的协议：[color=#2b91e3]传输控制协议（TCP）[/color]和[color=#2b91e3]用户数据报协议（UDP）[/color]。
	TCP协议提供的是一种可靠的、通过“三次握手”来连接的数据传输服务；而UDP协议提供的则是不保证可靠的（并不是不可靠）、无连接的数据传输服务。

### 应用层（Application Layer）
应用层是OSI参考模型的最高层，是用户与网络的接口。该层[color=#f4511e]通过应用程序来完成网络用户的应用需求[/color]，如文件传输、收发电子邮件等。

### 具体流程图
![图片描述](attimg://article/content/picture/201804/13/195205z2wd2xsednu20mmm.png)
[color=#b1b1b1]（还没太懂也懒，直接百度图片找张清晰的拿来用的。。）[/color]

两者主要区别在于: OSI参考模型虽然被看好，由于没把握好时机，技术不成熟，实现困难；相反，TCP/IP参考模型虽然有许多不尽人意的地方，但还是比较成功的。

[color=#b1b1b1]（更多内容请自行查阅，本节到此为止了。）[/color]


## TCP与UDP
[color=#2b91e3]TCP （Transmission Control Protocol）[/color]和[color=#2b91e3]UDP（User Datagram Protocol）[/color]协议属于传输层协议。其中[color=#ff5722]TCP提供IP环境下的数据可靠传输，它提供的服务包括数据流传送、可靠性、有效流控、全双工操作和多路复用，通过面向连接、端到端和可靠的数据包发送。[/color]通俗说，它是事先为所发送的数据开辟出连接好的通道，然后再进行数据发送；而[color=#ff5722]UDP则不为IP提供可靠性、流控或差错恢复功能[/color]。一般来说，TCP对应的是可靠性要求高的应用，而UDP对应的则是可靠性要求低、传输经济的应用。
* TCP支持的应用协议主要有：[color=#2b91e3]Telnet、FTP、SMTP[/color]等；
* UDP支持的应用层协议主要有：[color=#2b91e3]NFS（网络文件系统）、SNMP（简单网络管理协议）、DNS（主域名称系统）、TFTP（通用文件传输协议）[/color]等。
|比较|TCP|UDP|
|-|-|-|
|面向连接 | 是| 否|
|连接端 |点对点 |一对一，一对多，多对一和多对多的交互通信 |
|模式 |流模式 | 数据报模式|
|传输可靠性 |可靠 |非可靠 |
| 数据顺序|保证 |不保证 |
| 数据正确性|保证 |可能丢包 |
|速度 |慢 | 快|

### 什么是面向连接？
在互通之前TCP会通过三次握手建立连接，而UDP就不会这么干。所谓的建立连接是为了在客户端和服务端维护连接，而建立一定的数据结构来维护双方交互的状态，用这样的数据结构来保证所谓的面向连接的特性。
上面说过，TCP提供的数据无差错、不丢失、不重复、并且按序到达。而UDP做不到。

### 什么是传输可靠性？
TCP是有状态维护的，它知道自己发了什么，发给谁，应该接收什么等等。而UDP发了之后恕不负责。

### 什么是数据顺序和正确性？
TCP会根据网络情况自动调整自己的行为，例如可能包丢了，可能网络不好等等，它具有拥塞控制保证一定是按顺序接收到的。而UDP不管，像流水线工人一样，应用给它什么它就发什么，至于后面的人有没拿到会不会出问题不管！


## UDP适用场景
* 需要资源少、网络情况较好的内网或者对于丢包不敏感的场景。

* 不需要一对一建立连接沟通，而是可以直接广播。

* 需要处理速度快延迟低可接受少数丢包。

例如：
### 流媒体协议
如果直播软件使用基于TCP（例如RTMP协议），因为TCP的拥塞控制严格保证顺序导致只有上一个包收到才会继续确认下一个包，否则即使已经接收到了也会在缓存里等着。而对于直播来说以前的视频帧丢了也就丢了，一点都不重要，它们追求的是实时性而不是忍着卡顿看完整版。所以很多直播都是基于UDP实现自己的视频传输协议。

### 网络游戏
现在电竞游戏已经产业化，职业化，世界化了，你们会看到很多人已经对网络甚至键盘鼠标的要求之高。毫秒的延迟可能就是生与死的时差。
实时游戏中客户端和服务端要建立长连接保证传输，由于维护TCP连接需要在内核中维护一些数据结构所以一台机器能支持的TCP连接数是有限的，而不需要的连接的UDP在异步I/O机制引入之前常常是应对海量客户端连接的策略。
另一个还是TCP拥塞控制的问题，一般客户端会把鼠标和键盘的参数发给服务端，等它处理完所有用户的场景之后就返回给客户端解析渲染，一是如果数据包这么多游戏场景不强制需要全部也不要求顺序，二是那一瞬间的信息和这一瞬间的信息没什么关联了。
